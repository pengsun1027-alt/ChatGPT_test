<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>设备巡检系统 - PPE会话采集</title>

		<!-- Vant 4 CSS -->
		<link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/vant@4/lib/index.css" />
		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>

		<style>
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
				background: #f7f8fa;
			}
			.safe-bottom {
				padding-bottom: max(env(safe-area-inset-bottom), 0.75rem);
			}
		</style>
	</head>
	<body>
		<!-- 顶部导航栏 -->
		<header class="fixed inset-x-0 top-0 h-12 bg-white/90 backdrop-blur shadow-sm flex items-center justify-between px-4 z-50">
			<button class="w-8 h-8 flex items-center justify-center" onclick="history.back()">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
				</svg>
			</button>
			<h1 class="text-base font-semibold">PPE会话采集</h1>
			<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
				计划级 · 时窗级一次
			</span>
		</header>

		<!-- 主要内容区域 -->
		<main class="mt-12 px-4 pb-20 space-y-4">
			<!-- 选择今日实例（时窗） -->
			<div class="bg-white rounded-2xl shadow-sm p-4">
				<div class="flex items-center justify-between mb-3">
					<h3 class="font-semibold text-slate-800">选择今日实例（时窗）</h3>
					<span class="text-xs text-slate-500">计划：机组A日巡 · W33-1</span>
				</div>
				<div class="flex flex-wrap gap-2 mb-3">
					<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200">
						<div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
						12:00–13:00 · 当前
					</span>
					<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200">
						<div class="w-2 h-2 bg-slate-400 rounded-full mr-2"></div>
						08:00–09:00 · 已过
					</span>
					<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200">
						<div class="w-2 h-2 bg-slate-400 rounded-full mr-2"></div>
						18:00–19:00 · 未到
					</span>
				</div>
				<div class="text-xs text-slate-500">默认选择：进行中 > 可开始 > 最近未到 > 最近已完成</div>
			</div>

			<!-- 安全与PPE要求 -->
			<div class="bg-white rounded-2xl shadow-sm p-4">
				<h3 class="font-semibold text-slate-800 mb-3">安全与PPE要求</h3>
				<div class="text-sm text-slate-600 mb-4">
					进入作业区前需穿戴：安全帽、护目镜、绝缘手套、防护鞋；现场至少两人（执行+监护）。
				</div>
				<div class="space-y-3">
					<label class="flex items-start space-x-3">
						<input type="checkbox" id="ssp" class="form-checkbox h-4 w-4 text-blue-600 mt-1" />
						<span class="text-sm text-slate-700">我已阅读并同意本计划的 <strong class="font-semibold">SSP 安全要求</strong>（必勾）</span>
					</label>
					<label class="flex items-start space-x-3">
						<input type="checkbox" id="sop" class="form-checkbox h-4 w-4 text-blue-600 mt-1" />
						<span class="text-sm text-slate-700">我已知悉本计划的 <strong class="font-semibold">SOP 作业指导</strong>（必勾）</span>
					</label>
				</div>
			</div>

			<!-- 拍摄PPE -->
			<div class="bg-white rounded-2xl shadow-sm p-4">
				<h3 class="font-semibold text-slate-800 mb-3">拍摄PPE（合影1张）</h3>
				<p class="text-sm text-slate-600 mb-4">拍摄时自动加水印：时间/地点/计划/执行人/监护人</p>
				<div class="flex items-center space-x-4">
					<div id="mock" class="w-24 h-18 border-2 border-dashed border-slate-300 rounded-lg flex items-center justify-center text-xs text-slate-500 bg-slate-50">
						占位图
					</div>
					<button class="px-4 py-2 bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600" onclick="capture()">
						拍摄PPE
					</button>
				</div>
			</div>

			<!-- 回执信息 -->
			<div class="bg-white rounded-2xl shadow-sm p-4">
				<h3 class="font-semibold text-slate-800 mb-3">回执信息</h3>
				<p id="receipt" class="text-sm text-slate-600 mb-3">尚未采集</p>
				<div class="w-full bg-slate-200 rounded-full h-2">
					<div id="bar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
				</div>
			</div>
		</main>

		<!-- 底部操作栏 -->
		<div class="fixed inset-x-0 bottom-0 bg-white/95 backdrop-blur border-t border-slate-200 safe-bottom z-50">
			<div class="px-4 py-3 flex space-x-3">
				<a href="task-list-aggregate_with-sessionbar_step2.html" class="flex-1 py-3 bg-slate-100 text-slate-700 font-medium rounded-lg hover:bg-slate-200 text-center">
					返回列表
				</a>
				<button id="go" class="flex-1 py-3 bg-slate-300 text-slate-500 font-medium rounded-lg" disabled onclick="finish()">
					开始本时窗巡检
				</button>
			</div>
		</div>

		<!-- Vant 4 JS -->
		<script src="https://fastly.jsdelivr.net/npm/vant@4/lib/vant.min.js"></script>

		<script>
			let hasPhoto = false;

			function capture() {
				hasPhoto = true;
				document.getElementById('mock').textContent = '已拍摄';
				document.getElementById('mock').className = 'w-24 h-18 border-2 border-green-300 rounded-lg flex items-center justify-center text-xs text-green-700 bg-green-50';
				document.getElementById('bar').style.width = '66%';
				updateBtn();
				document.getElementById('receipt').textContent = '已拍摄 · 待勾选 SSP/SOP';
			}

			function updateBtn() {
				const ok = hasPhoto && document.getElementById('ssp').checked && document.getElementById('sop').checked;
				const goBtn = document.getElementById('go');
				
				if (ok) {
					goBtn.disabled = false;
					goBtn.className = 'flex-1 py-3 bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600';
					document.getElementById('bar').style.width = '100%';
					document.getElementById('receipt').textContent = '完成 · 12:01 · 站点A（示例）';
				} else {
					goBtn.disabled = true;
					goBtn.className = 'flex-1 py-3 bg-slate-300 text-slate-500 font-medium rounded-lg';
					document.getElementById('bar').style.width = hasPhoto ? '66%' : '0%';
				}
			}

			document.getElementById('ssp').addEventListener('change', updateBtn);
			document.getElementById('sop').addEventListener('change', updateBtn);

			function finish() {
				// 使用 Vant 的 Toast 组件
				if (typeof vant !== 'undefined') {
					vant.showToast('已完成 PPE + SSP/SOP 确认，返回原路径');
				} else {
					alert('已完成 PPE + SSP/SOP 确认，返回原路径并恢复动作');
				}
				setTimeout(() => {
					window.location.href = 'task-list-aggregate_with-sessionbar_step2.html';
				}, 1500);
			}
		</script>
	</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<title>工单详情</title>
		<style>
			:root {
				--primary: #2b6fff;
				--primary-active: #1c54f0;
				--primary-subtle: #e8eeff;
				--success: #22c55e;
				--warning: #f59e0b;
				--danger: #ef4444;
				--text: #0f172a;
				--muted: #64748b;
				--border: #e2e8f0;
				--bg: #f8fafc;
				--card: #ffffff;
				--shadow: 0 6px 16px rgba(16, 24, 40, 0.06);
			}
			* {
				box-sizing: border-box;
				-webkit-tap-highlight-color: transparent;
			}
			body {
				margin: 0;
				padding: 0;
				background: var(--bg);
				color: var(--text);
				font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Microsoft YaHei', Roboto, Arial;
				font-size: 16px;
				line-height: 1.5;
				/* 禁用纵向滚动条但保留滚动功能 */
				overflow-y: scroll;
			}
			/* Firefox 隐藏滚动条 */
			html {
				scrollbar-width: none;
			}

			/* 隐藏滚动条 */
			::-webkit-scrollbar {
				width: 0;
				background: transparent;
			}

			/* IE/Edge 隐藏滚动条 */
			-ms-overflow-style: none;
			a {
				color: inherit;
				text-decoration: none;
			}
			.container {
				padding: 16px;
			}
			.navbar {
				position: sticky;
				top: 0;
				z-index: 10;
				background: #fff;
				padding: 12px 16px;
				border-bottom: 1px solid var(--border);
				display: flex;
				align-items: center;
				gap: 12px;
			}
			.navbar .title {
				font-weight: 600;
				font-size: 18px;
			}
			.card {
				background: var(--card);
				border: 1px solid var(--border);
				border-radius: 12px;
				box-shadow: var(--shadow);
			}
			.card + .card {
				margin-top: 12px;
			}
			.btn {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				height: 44px;
				padding: 0 16px;
				border-radius: 12px;
				border: 1px solid var(--border);
				background: #fff;
				font-weight: 600;
			}
			.btn:active {
				transform: scale(0.98);
			}
			.btn-primary {
				background: var(--primary);
				border-color: var(--primary);
				color: #fff;
			}
			.btn-primary:disabled {
				background: #9db8ff;
				border-color: #9db8ff;
			}
			.btn-ghost {
				background: #fff;
				border-color: var(--border);
				color: var(--text);
			}
			.btn-small {
				height: 32px;
				padding: 0 12px;
				border-radius: 10px;
				font-size: 14px;
			}
			.input {
				width: 100%;
				height: 44px;
				border: 1px solid var(--border);
				border-radius: 10px;
				padding: 0 12px;
				background: #fff;
			}
			.input:focus {
				outline: none;
				border-color: var(--primary);
			}
			.row {
				display: flex;
				gap: 8px;
				align-items: center;
			}
			.col {
				display: flex;
				flex-direction: column;
				gap: 10px;
			}
			.small {
				font-size: 12px;
				color: var(--muted);
			}
			.helper {
				font-size: 12px;
				color: var(--muted);
			}
			.helper.error {
				color: var(--danger);
			}
			.badge {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				min-width: 16px;
				height: 16px;
				padding: 0 4px;
				border-radius: 999px;
				background: var(--danger);
				color: #fff;
				font-size: 12px;
				line-height: 1;
			}
			/* message list */
			.msg {
				padding: 12px;
			}
			.msg + .msg {
				border-top: 1px dashed var(--border);
			}
			.msg .head {
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			.msg .title {
				font-weight: 700;
			}
			.msg .unread {
				width: 8px;
				height: 8px;
				border-radius: 999px;
				background: var(--danger);
				margin-left: 6px;
			}
			.msg .meta {
				font-size: 12px;
				color: var(--muted);
			}
			.chips {
				display: flex;
				gap: 8px;
				overflow: auto;
				padding: 8px 16px;
				border-bottom: 1px solid var(--border);
				background: #fff;
				position: sticky;
				top: 54px;
				z-index: 9;
			}
			.chip {
				padding: 8px 12px;
				border: 1px solid var(--border);
				border-radius: 999px;
				background: #fff;
				font-size: 14px;
				white-space: nowrap;
			}
			.chip.active {
				background: var(--primary-subtle);
				border-color: var(--primary);
				color: var(--primary);
			}
			/* timeline */
			.timeline {
				padding: 12px;
			}
			.node {
				display: flex;
				gap: 12px;
				align-items: flex-start;
			}
			.node + .node {
				margin-top: 12px;
			}
			.dot {
				width: 12px;
				height: 12px;
				border-radius: 999px;
				background: var(--primary);
				margin-top: 6px;
			}
			.dot.gray {
				background: #cbd5e1;
			}
			.node .body {
				flex: 1;
			}
			.node .title {
				font-weight: 700;
				font-size: 14px;
			}
			.node .time {
				font-size: 12px;
				color: var(--muted);
			}
			.pill {
				font-size: 12px;
				border-radius: 999px;
				padding: 4px 8px;
				border: 1px solid var(--border);
				background: #fff;
			}
			.pill.gray {
				color: #475569;
			}
			.pill.blue {
				border-color: var(--primary);
				color: var(--primary);
			}
			.pill.green {
				border-color: var(--success);
				color: var(--success);
			}
			.pill.red {
				border-color: var(--danger);
				color: var(--danger);
			}
			.section {
				background: #fff;
				border: 1px solid var(--border);
				border-radius: 12px;
				box-shadow: var(--shadow);
				padding: 12px;
				margin: 12px 0;
			}
			.section .sec-head {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 8px;
			}
			.section .sec-title {
				font-weight: 700;
			}
			.photo-uploader {
				display: flex;
				gap: 8px;
				flex-wrap: wrap;
			}
			.photo {
				width: 72px;
				height: 72px;
				border-radius: 8px;
				border: 1px dashed var(--border);
				display: flex;
				align-items: center;
				justify-content: center;
				color: #64748b;
				font-size: 12px;
				cursor: pointer;
			}
			.bottom-affix {
				position: fixed;
				left: 0;
				right: 0;
				bottom: 0;
				background: #fff;
				border-top: 1px solid var(--border);
				padding: 12px 16px;
				display: flex;
				gap: 8px;
				z-index: 20;
			}
			.bottom-affix .btn {
				flex: 1;
			}
		</style>
	</head>
	<body>
		<div class="navbar"><div class="title">工单详情</div></div>

		<div class="container">
			<div class="card" style="padding: 12px">
				<div class="row" style="justify-content: space-between">
					<div>
						<div style="font-weight: 700">#WX-20250819-001 · 供水泵#1</div>
						<div class="small">轴承异响 · 发起人：张三 · 2025-08-19 09:10</div>
					</div>
					<div id="statusPill" class="pill gray">待接单</div>
				</div>
			</div>

			<div class="section">
				<div class="sec-head"><div class="sec-title">处理进度</div></div>
				<div class="timeline" id="timeline">
					<div class="node">
						<div class="dot"></div>
						<div class="body">
							<div class="title">工单创建</div>
							<div class="time">2025-08-19 09:10</div>
						</div>
					</div>
				</div>
			</div>

			<div class="section">
				<div class="sec-head"><div class="sec-title">处理记录</div></div>
				<div class="photo-uploader" id="photos">
					<div class="photo" onclick="addPhoto()">+ 照片</div>
				</div>
				<div class="col" style="margin-top: 12px">
					<textarea
						id="note"
						class="input"
						style="height: 90px"
						placeholder="填写处理说明（必填）"
					></textarea>
				</div>
			</div>
		</div>

		<div class="bottom-affix" id="actions">
			<button id="btnAccept" class="btn btn-primary" onclick="accept()">接单</button>
			<button id="btnUpload" class="btn" onclick="upload()" disabled>上传进度</button>
			<button id="btnDone" class="btn btn-primary" onclick="finish()" disabled>完成验收</button>
		</div>

		<script>
			let status = '待接单';
			let photoCount = 0;
			function addTimeline(title) {
				const tl = document.getElementById('timeline');
				const node = document.createElement('div');
				node.className = 'node';
				node.innerHTML = `<div class="dot"></div>
    <div class="body"><div class="title>${title}</div><div class="time">${new Date().toLocaleString('zh-CN', {
					hour12: false,
				})}</div></div>`;
				tl.appendChild(node);
			}
			function setStatus(s) {
				status = s;
				const pill = document.getElementById('statusPill');
				if (s === '待接单') pill.className = 'pill gray';
				if (s === '进行中') pill.className = 'pill blue';
				if (s === '已完成') pill.className = 'pill green';
				pill.textContent = s;
			}
			function accept() {
				setStatus('进行中');
				addTimeline('已接单');
				document.getElementById('btnAccept').disabled = true;
				document.getElementById('btnUpload').disabled = false;
			}
			function addPhoto() {
				const p = document.createElement('div');
				p.className = 'photo';
				p.textContent = 'IMG';
				const wrap = document.getElementById('photos');
				wrap.insertBefore(p, wrap.firstElementChild);
				photoCount++;
				lock();
			}
			function upload() {
				const note = document.getElementById('note').value.trim();
				if (note.length === 0) return alert('请填写处理说明');
				addTimeline('上传进度：' + note + (photoCount > 0 ? `（含${photoCount}张照片）` : ''));
				document.getElementById('note').value = '';
				photoCount = 0;
				lock();
			}
			function finish() {
				const anyTimeline = document.querySelectorAll('#timeline .node').length > 1;
				if (!anyTimeline) return alert('请先上传至少一次进度');
				setStatus('已完成');
				addTimeline('完成验收');
				document.getElementById('btnUpload').disabled = true;
				document.getElementById('btnDone').disabled = true;
			}
			function lock() {
				const canDone = document.querySelectorAll('#timeline .node').length > 1;
				document.getElementById('btnDone').disabled = !canDone || status !== '进行中';
			}
		</script>
	</body>
</html>

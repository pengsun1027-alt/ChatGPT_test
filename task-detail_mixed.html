<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>设备巡检系统 - 任务详情(逾期)</title>

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>

		<style>
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei',
					sans-serif;
				background: #f7f8fa;
				/* 禁用纵向滚动条但保留滚动功能 */
				overflow-y: scroll;
				/* IE/Edge 隐藏滚动条 */
				-ms-overflow-style: none;
			}
			/* Firefox 隐藏滚动条 */
			html {
				scrollbar-width: none;
			}
			/* 隐藏滚动条 */
			::-webkit-scrollbar {
				width: 0;
				background: transparent;
			}

			.safe-bottom {
				padding-bottom: max(env(safe-area-inset-bottom), 0.75rem);
			}
		</style>
	</head>
	<body>
		<!-- 顶部导航栏 -->
		<header
			class="fixed inset-x-0 top-0 h-12 bg-white/90 backdrop-blur shadow-sm flex items-center justify-between px-4 z-50"
		>
			<button class="w-8 h-8 flex items-center justify-center" onclick="history.back()">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
				</svg>
			</button>
			<h1 class="text-base font-semibold">任务详情</h1>
			<button class="w-8 h-8 flex items-center justify-center">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="2"
						d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zM12 13a1 1 0 110-2 1 1 0 010 2zM12 20a1 1 0 110-2 1 1 0 010 2z"
					/>
				</svg>
			</button>
		</header>

		<!-- 扫码状态栏 -->
		<div id="scanbar" class="fixed inset-x-0 top-12 bg-white border-b border-slate-200 z-40">
			<div class="flex items-center justify-between px-4 py-3">
				<div class="flex items-center space-x-3">
					<div class="w-2 h-2 bg-slate-400 rounded-full"></div>
					<div>
						<div id="scan-text" class="text-sm font-medium text-slate-800">未扫码</div>
						<div id="scan-desc" class="text-xs text-slate-500">请先到点扫码，完成位置与时间校验</div>
					</div>
				</div>
				<a
					class="px-3 py-1 text-white text-sm font-semibold rounded hover:-translate-y-px transition-all duration-200"
					href="#"
					style="background-color: #2563eb"
					onmouseover="this.style.backgroundColor='#1d4ed8'"
					onmouseout="this.style.backgroundColor='#2563EB'"
				>
					去扫码
				</a>
			</div>
		</div>

		<!-- 主要内容区域 -->
		<main class="mt-24 px-4 pb-20 space-y-4">
			<!-- 设备信息卡片 -->
			<div class="bg-white rounded-lg shadow-sm p-4">
				<div class="flex items-start justify-between mb-3">
					<div class="flex-1">
						<div class="flex items-center space-x-2 mb-1">
							<h3 class="text-lg font-bold text-slate-800">供水泵#1</h3>
							<span class="text-sm text-slate-500">DEV-001</span>
						</div>
						<div class="text-sm text-slate-600">一号厂 · 南区</div>
					</div>
					<span
						class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-600"
					>
						<span class="w-1.5 h-1.5 bg-current rounded-full mr-1.5"></span>批次 2025W33
					</span>
				</div>
				<button class="text-sm text-slate-500 underline" onclick="openDevUnavail()">设备无法巡检</button>
			</div>

			<!-- 时窗实例选择 -->
			<div class="bg-white rounded-lg shadow-sm p-4">
				<div class="flex items-center justify-between mb-3">
					<h3 class="font-semibold text-slate-800">选择今日时窗</h3>
					<span
						id="twStatus"
						class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700"
					>
						<span class="w-1.5 h-1.5 bg-current rounded-full mr-1.5"></span>逾期
					</span>
				</div>
				<div id="twButtons" class="flex flex-wrap gap-2">
					<button
						class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-700 border border-blue-200 cursor-pointer active"
						data-tw="08:00-09:00"
						onclick="selectTimeWindow(this)"
					>
						08:00–09:00
					</button>
					<button
						class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-600 cursor-pointer"
						data-tw="12:00-13:00"
						onclick="selectTimeWindow(this)"
					>
						12:00–13:00
					</button>
					<button
						class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-600 cursor-pointer"
						data-tw="18:00-19:00"
						onclick="selectTimeWindow(this)"
					>
						18:00–19:00
					</button>
				</div>
			</div>

			<!-- 项目清单 -->
			<div class="bg-white rounded-lg shadow-sm">
				<div class="px-4 py-4 border-b border-slate-100">
					<div class="flex items-center justify-between">
						<h3 class="font-semibold text-slate-800">本实例项目清单</h3>
						<span class="text-xs text-slate-500">当前实例：08:00–09:00 · 已逾期</span>
					</div>
				</div>

				<div class="divide-y divide-slate-100">
					<div class="flex items-center justify-between px-4 py-4">
						<div class="flex-1">
							<div class="text-sm font-medium text-slate-800 mb-1">电流</div>
							<button class="text-xs text-slate-500 underline" onclick='openProjUnavail("电流")'>
								无法填写
							</button>
						</div>
						<div class="flex items-center space-x-2">
							<span
								class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700"
							>
								<span class="w-1.5 h-1.5 bg-current rounded-full mr-1.5"></span>逾期
							</span>
							<a
								class="px-3 py-1 text-white text-xs font-semibold rounded hover:-translate-y-px transition-all duration-200"
								href="task-form_overdue.html"
								style="background-color: #2563eb"
								onmouseover="this.style.backgroundColor='#1d4ed8'"
								onmouseout="this.style.backgroundColor='#2563EB'"
							>
								开始记录
							</a>
						</div>
					</div>

					<div class="flex items-center justify-between px-4 py-4">
						<div class="flex-1">
							<div class="text-sm font-medium text-slate-800 mb-1">电压</div>
							<button class="text-xs text-slate-500 underline" onclick='openProjUnavail("电压")'>
								无法填写
							</button>
						</div>
						<div class="flex items-center space-x-2">
							<span
								class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700"
							>
								<span class="w-1.5 h-1.5 bg-current rounded-full mr-1.5"></span>逾期
							</span>
							<a
								class="px-3 py-1 text-white text-xs font-semibold rounded hover:-translate-y-px transition-all duration-200"
								href="task-form_overdue.html"
								style="background-color: #2563eb"
								onmouseover="this.style.backgroundColor='#1d4ed8'"
								onmouseout="this.style.backgroundColor='#2563EB'"
							>
								开始记录
							</a>
						</div>
					</div>

					<div class="flex items-center justify-between px-4 py-4">
						<div class="flex-1">
							<div class="text-sm font-medium text-slate-800 mb-1">振动</div>
							<button class="text-xs text-slate-500 underline" onclick='openProjUnavail("振动")'>
								无法填写
							</button>
						</div>
						<div class="flex items-center space-x-2">
							<span
								class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700"
							>
								<span class="w-1.5 h-1.5 bg-current rounded-full mr-1.5"></span>逾期
							</span>
							<a
								class="px-3 py-1 text-white text-xs font-semibold rounded hover:-translate-y-px transition-all duration-200"
								href="task-form_overdue.html"
								style="background-color: #2563eb"
								onmouseover="this.style.backgroundColor='#1d4ed8'"
								onmouseout="this.style.backgroundColor='#2563EB'"
							>
								开始记录
							</a>
						</div>
					</div>
				</div>
			</div>
		</main>

		<!-- 底部操作栏 -->
		<div class="fixed inset-x-0 bottom-0 bg-white/95 backdrop-blur border-t border-slate-200 safe-bottom z-50">
			<div class="px-4 py-3 flex space-x-3">
				<a
					class="flex-1 py-3 bg-red-500 text-white font-semibold rounded text-center hover:-translate-y-px transition-all duration-200"
					href="#"
				>
					异常报修
				</a>
				<a
					class="flex-1 py-3 text-white font-semibold rounded text-center hover:-translate-y-px transition-all duration-200"
					href="task-form.html"
					style="background-color: #2563eb"
					onmouseover="this.style.backgroundColor='#1d4ed8'"
					onmouseout="this.style.backgroundColor='#2563EB'"
				>
					开始记录
				</a>
			</div>
		</div>

		<!-- 底部弹窗 - 设备无法巡检 -->
		<div id="dev-unavail" class="fixed inset-0 bg-black/50 hidden items-end z-50">
			<div class="bg-white rounded-t-2xl w-full p-6">
				<h3 class="text-lg font-semibold mb-4">设备无法巡检</h3>
				<div class="flex flex-wrap gap-2 mb-4">
					<button
						class="px-3 py-1 border border-slate-300 rounded-full text-sm font-semibold hover:bg-slate-50 transition-all duration-200"
					>
						停电/断电
					</button>
					<button
						class="px-3 py-1 border border-slate-300 rounded-full text-sm font-semibold hover:bg-slate-50 transition-all duration-200"
					>
						设备检修中
					</button>
					<button
						class="px-3 py-1 border border-slate-300 rounded-full text-sm font-semibold hover:bg-slate-50 transition-all duration-200"
					>
						安全风险
					</button>
					<button
						class="px-3 py-1 border border-slate-300 rounded-full text-sm font-semibold hover:bg-slate-50 transition-all duration-200"
					>
						无权限进入
					</button>
					<button
						class="px-3 py-1 border border-slate-300 rounded-full text-sm font-semibold hover:bg-slate-50 transition-all duration-200"
					>
						其他
					</button>
				</div>
				<textarea
					id="dev-reason"
					class="w-full min-h-20 border border-slate-300 rounded-lg p-3 text-sm resize-none"
					placeholder="请补充具体原因（必填）"
				></textarea>
				<div class="flex space-x-3 mt-4">
					<button
						class="flex-1 py-3 bg-slate-100 text-slate-700 font-medium rounded hover:bg-slate-200 transition-all duration-200"
						onclick="closeDevUnavail()"
					>
						取消
					</button>
					<button
						class="flex-1 py-3 text-white font-semibold rounded hover:-translate-y-px transition-all duration-200"
						onclick="submitDevUnavail()"
						style="background-color: #2563eb"
						onmouseover="this.style.backgroundColor='#1d4ed8'"
						onmouseout="this.style.backgroundColor='#2563EB'"
					>
						提交
					</button>
				</div>
			</div>
		</div>

		<!-- 底部弹窗 - 项目无法填写 -->
		<div id="proj-unavail" class="fixed inset-0 bg-black/50 hidden items-end z-50">
			<div class="bg-white rounded-t-2xl w-full p-6">
				<h3 id="proj-title" class="text-lg font-semibold mb-4">项目无法填写</h3>
				<div class="flex flex-wrap gap-2 mb-4">
					<button
						class="px-3 py-1 border border-slate-300 rounded-full text-sm font-semibold hover:bg-slate-50 transition-all duration-200"
					>
						无法接近测点
					</button>
					<button
						class="px-3 py-1 border border-slate-300 rounded-full text-sm font-semibold hover:bg-slate-50 transition-all duration-200"
					>
						仪表损坏
					</button>
					<button
						class="px-3 py-1 border border-slate-300 rounded-full text-sm font-semibold hover:bg-slate-50 transition-all duration-200"
					>
						工况不允许
					</button>
					<button
						class="px-3 py-1 border border-slate-300 rounded-full text-sm font-semibold hover:bg-slate-50 transition-all duration-200"
					>
						其他
					</button>
				</div>
				<textarea
					id="proj-reason"
					class="w-full min-h-20 border border-slate-300 rounded-lg p-3 text-sm resize-none"
					placeholder="请补充具体原因（必填）"
				></textarea>
				<div class="flex space-x-3 mt-4">
					<button
						class="flex-1 py-3 bg-slate-100 text-slate-700 font-medium rounded hover:bg-slate-200 transition-all duration-200"
						onclick="closeProjUnavail()"
					>
						取消
					</button>
					<button
						class="flex-1 py-3 text-white font-semibold rounded hover:-translate-y-px transition-all duration-200"
						onclick="submitProjUnavail()"
						style="background-color: #2563eb"
						onmouseover="this.style.backgroundColor='#1d4ed8'"
						onmouseout="this.style.backgroundColor='#2563EB'"
					>
						提交
					</button>
				</div>
			</div>
		</div>

		<script>
			// 时窗数据和状态映射
			const timeWindowStatus = {
				'08:00-09:00': { status: '逾期', color: 'red' },
				'12:00-13:00': { status: '可开始', color: 'blue' },
				'18:00-19:00': { status: '未到时间', color: 'gray' },
			};

			let selectedTimeWindow = '08:00-09:00'; // 默认选中逾期的

			function selectTimeWindow(button) {
				selectedTimeWindow = button.dataset.tw;

				// 更新按钮样式
				document.querySelectorAll('#twButtons button').forEach((btn) => {
					btn.className =
						'inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-600 cursor-pointer';
				});

				button.className =
					'inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-700 border border-blue-200 cursor-pointer active';

				// 更新状态标签
				updateStatusLabel();
			}

			function updateStatusLabel() {
				const status = timeWindowStatus[selectedTimeWindow];
				const statusEl = document.getElementById('twStatus');

				if (status.color === 'green') {
					statusEl.className =
						'inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700';
				} else if (status.color === 'blue') {
					statusEl.className =
						'inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-700';
				} else if (status.color === 'red') {
					statusEl.className =
						'inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700';
				} else {
					statusEl.className =
						'inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-600';
				}

				statusEl.innerHTML = `<span class="w-1.5 h-1.5 bg-current rounded-full mr-1.5"></span>${status.status}`;
			}

			// 页面加载完成后初始化状态
			document.addEventListener('DOMContentLoaded', function () {
				updateStatusLabel();
			});

			function openDevUnavail() {
				document.getElementById('dev-unavail').classList.remove('hidden');
				document.getElementById('dev-unavail').classList.add('flex');
			}
			function closeDevUnavail() {
				document.getElementById('dev-unavail').classList.add('hidden');
				document.getElementById('dev-unavail').classList.remove('flex');
			}
			function submitDevUnavail() {
				const t = document.getElementById('dev-reason').value.trim();
				if (!t) {
					alert('请填写原因');
					return;
				}
				alert('已记录：' + t);
				closeDevUnavail();
			}
			let currentProj = '';
			function openProjUnavail(n) {
				currentProj = n;
				document.getElementById('proj-title').textContent = '项目无法填写 · ' + n;
				document.getElementById('proj-unavail').classList.remove('hidden');
				document.getElementById('proj-unavail').classList.add('flex');
			}
			function closeProjUnavail() {
				document.getElementById('proj-unavail').classList.add('hidden');
				document.getElementById('proj-unavail').classList.remove('flex');
			}
			function submitProjUnavail() {
				const t = document.getElementById('proj-reason').value.trim();
				if (!t) {
					alert('请填写原因');
					return;
				}
				alert('已记录[' + currentProj + ']：' + t);
				closeProjUnavail();
			}
		</script>
	</body>
</html>
